# Dishcovery: AI-Powered Recipe Generation from Food Images

## ğŸ¯ Feature Overview

This implementation enables users to upload a photo of food and receive a complete, structured recipe generated by Gemini Vision AI. The feature includes robust error handling, input validation, and a beautiful UI for displaying recipes with nutritional information.

## âœ¨ Features Implemented

### Backend (`/api/generate-recipe`)

- âœ… **Image Upload & Validation**
  - Accepts multipart/form-data with image file
  - Validates file type (PNG, JPG, JPEG, GIF, WEBP)
  - Verifies image integrity using PIL
  - Returns clear error messages for invalid inputs

- âœ… **AI Integration (Gemini Vision)**
  - Uses `gemini-1.5-flash` model for image analysis
  - Secure API key storage via environment variables
  - Comprehensive prompt engineering for structured output
  - JSON parsing with fallback to raw text

- âœ… **Structured Recipe Output**
  ```json
  {
    "title": "Recipe Name",
    "prep_time": "15 min",
    "cook_time": "25 min",
    "servings": "4",
    "ingredients": ["200g chicken breast, cubed", "..."],
    "steps": ["Step 1 instructions", "..."],
    "nutrition": {
      "calories": "420 kcal",
      "protein": "32g",
      "fat": "12g",
      "carbs": "35g"
    },
    "tips": "Serving suggestions and variations"
  }
  ```

- âœ… **Error Handling**
  - 400: Invalid/missing image, corrupted file
  - 429: Rate limit handling
  - 500: AI API failures with user-friendly messages
  - All errors include actionable guidance

- âœ… **Optional Parameters**
  - `language`: Recipe language (default: 'en')
  - `dietary_restrictions`: E.g., "vegetarian", "gluten-free"
  - `cuisine_preference`: E.g., "Italian", "Thai"

### Frontend

- âœ… **Image Upload Component**
  - Web: Native HTML5 file input with preview
  - Native: Expo ImagePicker integration
  - Visual feedback with image preview

- âœ… **Enhanced Recipe Display**
  - Recipe metadata (prep/cook time, servings)
  - Organized sections: Ingredients, Instructions, Nutrition, Tips
  - Beautiful nutrition grid with color-coded values
  - Responsive design with theme consistency

- âœ… **Error Handling**
  - Network error detection
  - User-friendly error messages
  - Loading states with activity indicator
  - Retry guidance

## ğŸš€ Getting Started

### Prerequisites

1. **Gemini API Key**: Get yours at [Google AI Studio](https://makersuite.google.com/app/apikey)
2. **Python 3.10+** and **Node.js 18+**

### Backend Setup

```bash
cd backend

# Install dependencies
pip install -r requirements.txt

# Create .env file
cp .env.example .env

# Add your Gemini API key to .env
GEMINI_API_KEY=your-actual-api-key-here

# Run the server
python app.py
```

Server will start on `http://localhost:5001`

### Frontend Setup

```bash
cd frontend

# Install dependencies
npm install

# Start Expo development server
npm start

# For web only
npm run web
```

## ğŸ“ API Usage

### Request

```bash
curl -X POST http://localhost:5001/api/generate-recipe \
  -F "file=@path/to/food-image.jpg" \
  -F "language=en" \
  -F "dietary_restrictions=vegetarian" \
  -F "cuisine_preference=Italian"
```

### Response (Success)

```json
{
  "success": true,
  "recipe": {
    "title": "Spicy Thai Basil Stir-Fry",
    "prep_time": "15 min",
    "cook_time": "25 min",
    "servings": "4",
    "ingredients": [
      "200g chicken breast, cubed",
      "150g bell peppers, sliced",
      "100g basil leaves, chopped"
    ],
    "steps": [
      "Heat oil in a pan, sautÃ© chicken until browned.",
      "Add peppers and stir-fry for 5 minutes."
    ],
    "nutrition": {
      "calories": "420 kcal",
      "protein": "32g",
      "fat": "12g",
      "carbs": "35g"
    },
    "tips": "Serve with jasmine rice and garnish with lime wedges."
  },
  "source": "gemini-vision"
}
```

### Response (Error)

```json
{
  "error": "No image file provided. Please upload a food photo."
}
```

## ğŸ§ª Testing

### Backend Tests

```bash
cd backend

# Run all tests
pytest

# Run with coverage
pytest --cov=api --cov-report=html

# Run specific test file
pytest tests/test_recipes.py -v
```

### Test Coverage

- âœ… Missing file validation
- âœ… Invalid file type validation
- âœ… Corrupted image detection
- âœ… Empty filename handling
- âœ… Optional parameters support
- âœ… Response structure validation

## ğŸ”’ Security Features

1. **API Key Protection**
   - Stored in environment variables (never hardcoded)
   - Not exposed in responses or logs
   - `.env` file excluded from version control

2. **Input Validation**
   - File type whitelist (no executables)
   - Image integrity verification
   - File size limits (16MB default)

3. **CORS Configuration**
   - Configurable allowed origins
   - Development and production modes

4. **Error Handling**
   - No sensitive information in error messages
   - Sanitized user input
   - Rate limit protection

## ğŸ“Š Acceptance Criteria Status

| Criteria | Status | Notes |
|----------|--------|-------|
| Input Validation | âœ… Complete | Rejects invalid images with clear 400 errors |
| AI Integration | âœ… Complete | Gemini Vision API with secure key storage |
| Output Structure | âœ… Complete | Full JSON with ingredients, steps, nutrition, tips |
| Error Handling | âœ… Complete | Rate limits, API failures, invalid input all handled |
| Security | âœ… Complete | Environment variables, input validation, CORS |

## ğŸ¨ UI Screenshots

### Upload Screen
- Clean card-based design
- Image preview before upload
- Clear call-to-action button
- Helpful tips for best results

### Recipe Display
- Professional recipe layout
- Color-coded nutrition facts
- Easy-to-follow step-by-step instructions
- Serving suggestions highlighted

## ğŸ”§ Configuration

### Environment Variables

```bash
# Required
GEMINI_API_KEY=your-key-here

# Optional
FLASK_ENV=development
DEFAULT_LANGUAGE=en
MAX_CONTENT_LENGTH=16777216  # 16MB
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:19006
```

### Frontend API Base URL

Edit `frontend/src/api/index.js`:

```javascript
const API_BASE = "http://localhost:5001";  // Change for production
```

## ğŸš€ Deployment

### Backend (Vercel)

```bash
cd backend
vercel --prod
```

### Frontend (Vercel/Netlify)

```bash
cd frontend
npm run build-pwa
vercel --prod
```

## ğŸ“ˆ Performance Considerations

- **AI Response Time**: 5-10 seconds (Gemini API processing)
- **Image Size**: Keep under 5MB for best performance
- **Caching**: Future enhancement with Redis
- **Rate Limits**: Gemini free tier has quotas

## ğŸ› ï¸ Troubleshooting

### "AI service authentication failed"
- Check `GEMINI_API_KEY` in `.env`
- Verify API key is active in Google AI Studio

### "Invalid or corrupted image"
- Ensure file is a valid image format
- Try a different photo
- Check file isn't corrupted

### "Rate limit reached"
- Wait 60 seconds and retry
- Upgrade Gemini API plan if needed

## ğŸ“š Tech Stack

- **Backend**: Flask 3.0.0, Gemini 0.8.3, Pillow 10.1.0
- **Frontend**: React Native, Expo, Axios
- **AI**: Google Gemini 1.5 Flash (Vision)
- **Testing**: pytest, pytest-cov

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests: `pytest`
5. Submit a pull request

## ğŸ“„ License

MIT License - see LICENSE file for details

## ğŸ™ Acknowledgments

- Google Gemini AI for vision capabilities
- Expo team for cross-platform tools
- Flask community for excellent documentation

---

**Built with â¤ï¸ by the Dishcovery Team**
